{% extends 'choicemaster/base.html' %}

{% block content %}
    <h2>Evaluation on {{ subject.subject_title }}</h2>
    <h3> Question: {{ question.question_text }}</h3>
    <form action="{% url 'resolve_exam' %}" method="post">
        {% csrf_token %}
        {{ form.answer }}
        <p id="correct_answer_p" style="display: none">
            <b>Correct answer: </b><span id="correct_answer"></span>
        </p>
        <p id="chosen_answer_p" style="display: none">
            <b>Chosen answer: </b><span id="chosen_answer"></span>
        </p>
        <p id="submit"><button type="button" onclick="submit_answer();">Submit</button></p>
        <p id="nextq" style="display: none;"><input type="submit" value="Next"/></p>
        <input type="hidden" name="exam_id" value="{{ exam_id }}">
    </form>
    <div id="question_id" style="display:none">{{ question.id }}</div>

    <button onclick="open_report()"> Same questions?</button>
    <p></p>
    <ul style="display:none" id="IDR">
        {% for quest in questions_used %}
            {% if not forloop.last %}
                 <input type="checkbox" id="C{{quest.id}}">{{quest.question_text}}<p></p>
            {% endif %}
        {% endfor %}
        <button onclick="send_r({{questions.id}})"> Send </button>
    </ul>
    <p></p>
    <button onclick="open_report2()"> Report questions</button>
        <ul style="display:none" id="ID2">
            <p></p>
            Decription <input id="ID3" type="text"name="Edit">
            <button onclick="send_report({{ question.id }})"> Send </button>
        </ul>



    <script type="text/javascript">
        function send_r(idq){
            var i = 0;
            while(true){
                var x = document.getElementById("C" + i.toString());
                if(x.checked == true){
                    $.ajax({
                        type: "POST",
                        url: "/ajax/edit/autoreport/",
                        dataType: "json",
                        data: {'id1': i,
                               'id2': idq
                        }
                     });
                    break;
                }
                i = i+1;
            }
            window.alert("chau");
            location.reload(false);
        }

       function send_report(idq){
           $.ajax({
                type: "POST",
                url: "/ajax/edit/reporting/",
                dataType: "json",
                data: {'idq':idq ,
                        'description':document.getElementById("ID3").value
                }
            });
           location.reload(false);
       }
    </script>

    <script type="text/javascript">
        function open_report(){
        var a = document.getElementById("IDR");
        if(a.style.display == "none"){
            a.style.display = "inline";
        }
        else{
            a.style.display = "none";
        }
    }

    function open_report2(){
        var a = document.getElementById("ID2");
        if(a.style.display == "none"){
            a.style.display = "inline";
        }
        else{
            a.style.display = "none";
        }
    }
    </script>


    <script type="text/javascript">
    var t_out;
    $(document).ready(function() {
        $('label[for="id_answer_0"]').parent().hide();
        console.log("Hid the mofo")
        var timer = {{ timer }};
        var time = timer*1000;
        t_out = setTimeout("submit_answer()", time);
    });

    function submit_answer() {
        var e = document.getElementById("question_id").innerHTML;
        clearTimeout(t_out);
        $.ajax({
            type: 'POST',
            url: '/ajax/get_correct/',
            dataType: 'json',
            data: {'idq': e},
            success: function(data) {
                // Show correct answer
                $("#correct_answer_p").show();
                $("#correct_answer").text(data['answer']);
                //  Hide answers and show final submit button
                $("#id_answer").hide();
                $("#submit").hide();
                $("#nextq").show();
                console.log("test:", data.answer);
                console.log("success!");
            }
        });
    }
    </script>
{% endblock %}