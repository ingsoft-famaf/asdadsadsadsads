{% extends 'choicemaster/base.html' %}

{% block content %}
    <h2>Evaluation on {{ subject.subject_title }}</h2>
    <h3> Question: {{ question.question_text }}</h3>
    <form id="form" action="{% url 'resolve_exam' %}" method="post">
        {% csrf_token %}
        {{ form.answer }}
        <p id="correct_answer_p" style="display: none">
            <b>Correct answer: </b><span id="correct_answer"></span>
        </p>
        <p id="chosen_answer_p" style="display: none">
            <b>Chosen answer: </b><span id="chosen_answer"></span>
        </p>
        <p id="submit"><button type="button" onclick="submit_answer();">Submit</button></p>
        <p id="nextq" style="display: none;"><input type="submit" value="Next"/></p>
        <input type="hidden" name="exam_id" value="{{ exam_id }}">
    </form>
    <div id="question_id" style="display:none">{{ question.id }}</div>

   <button onclick="open_report()"> Repeated question</button>
    <p></p>
    <ul style="display:none" id="IDR">
        {% for quest in questions_used %}
            <input type="checkbox" id="C{{ quest.id|slugify }}">{{quest.question_text}}
            <p></p>
        {% endfor %}
        <button onclick="reporting({{ questions_used }},{{ question.id  }} )">
            Reporting</button>
    </ul>

    <script type="text/javascript">
    var id;
        function reporting(questions, idq){
            for (quest in questions){
                var x = document.getElementById("C"+quest.id);
                if(x.checked == true){
                    id = quest.id;
                    break;
                }
            }
        $.ajax({
                type: "POST",
                url: "/ajax/edit/autoreport/",
                dataType: "json",
                data: {'id1':id ,
                        'id2': idq
                }
            });
        }
    </script>

    <script type="text/javascript">
        function open_report(){
        var a = document.getElementById("IDR");
        if(a.style.display == "none"){
            a.style.display = "inline";
        }
        else{
            a.style.display = "none";
        }
    }
    </script>


    <script type="text/javascript">
    var t_out;
    $(document).ready(function() {
        $('label[for="id_answer_0"]').parent().hide();
        var timer = {{ timer }};
        var time = timer*1000;
        t_out = setTimeout("submit_answer()", time);

        // Reset display for blocks
        $("#correct_answer_p").hide();
        $("#chosen_answer_p").hide();
        $("#id_answer").show();
        $("#submit").show();
        $("#nextq").hide();
    });

    function submit_answer() {
        var val = $('input[name="answer"]:checked').val();
        if (val.length == 0) {
            $("#chosen_answer").text("No answer chosen");
            $("#chosen_answer_p").show()
            return;
        }
        console.log("val:", val);
        var e = document.getElementById("question_id").innerHTML;
        clearTimeout(t_out);
        $.ajax({
            type: 'POST',
            url: '/ajax/get_correct/',
            dataType: 'json',
            data: {'idq': e},
            success: function(data) {
                // Show correct answer
                $("#correct_answer_p").show();
                $("#correct_answer").text(data['answer']);
                //  Hide answers and show final submit button
                $("#id_answer").hide();
                $("#submit").hide();
                $("#nextq").show();
                console.log("test:", data.answer);
                console.log("success!");
            }
        });
    }
    </script>
{% endblock %}
